{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: Debug DeepSpeed SFT",
            "type": "python",
            "request": "launch",
            // Use the full path to the deepspeed executable in your conda env
            // Find it by running `which deepspeed` in your activated terminal
            "program": "/home/hua/anaconda3/envs/qwen_train/bin/deepspeed",
            "args": [
                // --- Your Python script is the first argument ---
                "src/train/train_sft.py",

                // --- Now, copy all arguments from your shell script ---
                "--use_liger", "True",
                "--lora_enable", "True",
                "--use_dora", "False",
                "--lora_namespan_exclude", "['lm_head', 'embed_tokens']",
                "--lora_rank", "64",
                "--lora_alpha", "64",
                "--lora_dropout", "0.05",
                "--num_lora_modules", "-1",
                "--deepspeed", "scripts/zero3_offload.json",
                "--model_id", "Qwen/Qwen2-VL-2B-Instruct", // Manually replaced $MODEL_NAME
                "--data_path", "qwen_finetuning_dataset.json",
                "--image_folder", "plots",
                "--remove_unused_columns", "False",
                "--freeze_vision_tower", "False",
                "--freeze_llm", "True",
                "--freeze_merger", "False",
                "--bf16", "True",
                "--fp16", "False",
                "--disable_flash_attn2", "True",
                "--output_dir", "output/testing_lora",
                "--num_train_epochs", "1",
                "--per_device_train_batch_size", "4", // Manually replaced $BATCH_PER_DEVICE
                "--gradient_accumulation_steps", "1", // Manually calculated
                "--image_min_pixels", "222272",     // Manually calculated (256*28*28)
                "--image_max_pixels", "1433600",    // Manually calculated (1280*28*28)
                "--learning_rate", "1e-4",
                "--merger_lr", "1e-5",
                "--vision_lr", "2e-6",
                "--weight_decay", "0.1",
                "--warmup_ratio", "0.03",
                "--lr_scheduler_type", "cosine",
                "--logging_steps", "1",
                "--tf32", "True",
                "--gradient_checkpointing", "True",
                "--report_to", "tensorboard",
                "--lazy_preprocess", "True",
                "--save_strategy", "steps",
                "--save_steps", "200",
                "--save_total_limit", "10",
                "--dataloader_num_workers", "4"
            ],
            "env": {
                // Replicate the 'export PYTHONPATH' command
                "PYTHONPATH": "${workspaceFolder}/src:${env:PYTHONPATH}"
            },
            "console": "integratedTerminal"
        }
    ]
}